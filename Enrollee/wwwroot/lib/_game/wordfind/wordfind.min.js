(function(){"use strict";var n=function(){var t="АБВГДЕЁЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯ",i=["horizontal","vertical"],n={horizontal:function(n,t,i){return{x:n+i,y:t}},horizontalBack:function(n,t,i){return{x:n-i,y:t}},vertical:function(n,t,i){return{x:n,y:t+i}},verticalUp:function(n,t,i){return{x:n,y:t-i}},diagonal:function(n,t,i){return{x:n+i,y:t+i}},diagonalBack:function(n,t,i){return{x:n-i,y:t+i}},diagonalUp:function(n,t,i){return{x:n+i,y:t-i}},diagonalUpBack:function(n,t,i){return{x:n-i,y:t-i}}},u={horizontal:function(n,t,i,r,u){return r>=n+u},horizontalBack:function(n,t,i,r,u){return n+1>=u},vertical:function(n,t,i,r,u){return i>=t+u},verticalUp:function(n,t,i,r,u){return t+1>=u},diagonal:function(n,t,i,r,u){return r>=n+u&&i>=t+u},diagonalBack:function(n,t,i,r,u){return n+1>=u&&i>=t+u},diagonalUp:function(n,t,i,r,u){return r>=n+u&&t+1>=u},diagonalUpBack:function(n,t,i,r,u){return n+1>=u&&t+1>=u}},f={horizontal:function(n,t){return{x:0,y:t+1}},horizontalBack:function(n,t,i){return{x:i-1,y:t}},vertical:function(n,t){return{x:0,y:t+100}},verticalUp:function(n,t,i){return{x:0,y:i-1}},diagonal:function(n,t){return{x:0,y:t+1}},diagonalBack:function(n,t,i){return{x:i-1,y:n>=i-1?t+1:t}},diagonalUp:function(n,t,i){return{x:0,y:t<i-1?i-1:t+1}},diagonalUpBack:function(n,t,i){return{x:i-1,y:n>=i-1?t+1:t}}},e=function(n,t){for(var r=[],u,f,i=0;i<t.height;i++)for(r.push([]),u=0;u<t.width;u++)r[i].push("");for(i=0,f=n.length;i<f;i++)if(!o(r,t,n[i]))return null;return r},o=function(t,i,u){var e=r(t,i,u),f;return e.length===0?!1:(f=e[Math.floor(Math.random()*e.length)],c(t,u,f.x,f.y,n[f.orientation]),!0)},r=function(t,i,r){for(var c,p,a=[],w=i.height,b=i.width,k=r.length,v=0,y=0,d=i.orientations.length;y<d;y++)for(var l=i.orientations[y],g=u[l],nt=n[l],tt=f[l],e=0,o=0;o<w;)g(e,o,w,b,k)?(c=s(r,t,e,o,nt),(c>=v||!i.preferOverlap&&c>-1)&&(v=c,a.push({x:e,y:o,orientation:l,overlap:c})),e++,e>=b&&(e=0,o++)):(p=tt(e,o,k),e=p.x,o=p.y);return i.preferOverlap?h(a,v):a},s=function(n,t,i,r,u){for(var e,o,s=0,f=0,h=n.length;f<h;f++)if(e=u(i,r,f),o=t[e.y][e.x],o===n[f])s++;else if(o!=="")return-1;return s},h=function(n,t){for(var r=[],i=0,u=n.length;i<u;i++)n[i].overlap>=t&&r.push(n[i]);return r},c=function(n,t,i,r,u){for(var e,f=0,o=t.length;f<o;f++)e=u(i,r,f),n[e.y][e.x]=t[f]};return{validOrientations:["horizontal","vertical"],orientations:n,newPuzzle:function(n,r){var a,u,s,h,c,p,w;if(!n.length)throw new Error("Zero words provided");var l,o,v=0,y=0,f=r||{};for(l=n.slice(0).sort(),a=l[0].length,u={height:f.height||a,width:f.width||a,orientations:f.orientations||i,fillBlanks:f.fillBlanks!==undefined?f.fillBlanks:!0,allowExtraBlanks:f.allowExtraBlanks!==undefined?f.allowExtraBlanks:!0,maxAttempts:f.maxAttempts||3,maxGridGrowth:f.maxGridGrowth!==undefined?f.maxGridGrowth:10,preferOverlap:f.preferOverlap!==undefined?f.preferOverlap:!0};!o;){while(!o&&v++<u.maxAttempts)o=e(l,u);if(!o){if(y++,y>u.maxGridGrowth)throw new Error("No valid grid found and not allowed to grow more");console.log("No valid grid found after many attempts, trying with bigger grid");u.height++;u.width++;v=0}}if(u.fillBlanks){if(h=0,typeof u.fillBlanks=="function"?c=u.fillBlanks:typeof u.fillBlanks=="string"?(s=u.fillBlanks.toLowerCase().split(""),c=function(){return s.pop()||h++&&""}):c=function(){return t[Math.floor(Math.random()*t.length)]},p=this.fillBlanks({puzzle:o,extraLetterGenerator:c}),s&&s.length)throw new Error("Some extra letters provided were not used: "+s);if(s&&h&&!u.allowExtraBlanks)throw new Error(h+" extra letters were missing to fill the grid");w=100*(1-p/(u.width*u.height))}return o},newPuzzleLax:function(n,t){var t,i,r,f;try{return this.newPuzzle(n,t)}catch(u){if(!t.allowedMissingWords)throw u;for(t=Object.assign({},t),t.allowedMissingWords--,i=0;i<n.length;i++){r=n.slice(0);r.splice(i,1);try{return f=this.newPuzzleLax(r,t),console.log('Solution found without word "'+n[i]+'"'),f}catch(u){}}throw u;}},fillBlanks:function(n){for(var f,i,e,r=n.puzzle,o=n.extraLetterGenerator,u=0,t=0,s=r.length;t<s;t++)for(f=r[t],i=0,e=f.length;i<e;i++)r[t][i]||(r[t][i]=o(),u++);return u},solve:function(n,t){for(var u,f,h={height:n.length,width:n[0].length,orientations:i,preferOverlap:!0},o=[],s=[],e=0,c=t.length;e<c;e++)u=t[e],f=r(n,h,u),f.length>0&&f[0].overlap===u.length?(f[0].word=u,o.push(f[0])):s.push(u);return{found:o,notFound:s}},print:function(n){for(var r,t,f,i="",u=0,e=n.length;u<e;u++){for(r=n[u],t=0,f=r.length;t<f;t++)i+=(r[t]===""?" ":r[t])+" ";i+="\n"}return console.log(i),i}}},t=typeof exports!="undefined"&&exports!==null?exports:window;t.wordfind=n()}).call(undefined),function(n,t,i){"use strict";var f=function(n,i){for(var e,u,o,r="",f=0,s=i.length;f<s;f++){for(e=i[f],r+="<div>",u=0,o=e.length;u<o;u++)r+='<button class="puzzleSquare" x="'+u+'" y="'+f+'">',r+=e[u]||"&nbsp;",r+="<\/button>";r+="<\/div>"}t(n).html(r)},e=function(){return words},u=function(n,t,r,u){var f,o,e;for(f in i.orientations)if(o=i.orientations[f],e=o(n,t,1),e.x===r&&e.y===u)return f;return null},r=function(r,o){this.wordFound=function(){};var c,v,l,s=[],a,h="",y=function(){t(this).addClass("selected");l=this;s.push(this);h=t(this).text()},b=function(t){var i=t.originalEvent.touches[0].pageX,r=t.originalEvent.touches[0].pageY,u=n.elementFromPoint(i,r);p(u)},k=function(){p(this)},p=function(n){var i,e,r,c,o,f;if(l&&(i=s[s.length-1],i!=n)){for(r=0,c=s.length;r<c;r++)if(s[r]==n){e=r+1;break}while(e<s.length)t(s[s.length-1]).removeClass("selected"),s.splice(e,1),h=h.substr(0,h.length-1);(o=u(t(l).attr("x")-0,t(l).attr("y")-0,t(n).attr("x")-0,t(n).attr("y")-0),o&&(s=[l],h=t(l).text(),i!==l&&(t(i).removeClass("selected"),i=l),a=o),f=u(t(i).attr("x")-0,t(i).attr("y")-0,t(n).attr("x")-0,t(n).attr("y")-0),f)&&(a&&a!==f||(a=f,d(n)))}},d=function(n){for(var i=0,r=c.length;i<r;i++)if(c[i].indexOf(h+t(n).text())===0){t(n).addClass("selected");s.push(n);h+=t(n).text();break}},w=function(){for(var n=0,i=c.length;n<i;n++)c[n]===h&&(t(".selected").addClass("found"),c.splice(n,1),this.wordFound(h),t(".word-to-find."+h).addClass("wordFound")),c.length===0&&(t(".puzzleSquare").addClass("complete"),setTimeout(function(){window.parent.postMessage("quest-ok","*")},2e3));t(".selected").removeClass("selected");l=null;s=[];h="";a=null}.bind(this);if(t("input.word").removeClass("wordFound"),c=e().sort(),v=i.newPuzzleLax(c,o),f(r,v),window.navigator.msPointerEnabled){t(".puzzleSquare").on("MSPointerDown",y);t(".puzzleSquare").on("MSPointerOver",p);t(".puzzleSquare").on("MSPointerUp",w)}else{t(".puzzleSquare").mousedown(y);t(".puzzleSquare").mouseenter(k);t(".puzzleSquare").mouseup(w);t(".puzzleSquare").on("touchstart",y);t(".puzzleSquare").on("touchmove",b);t(".puzzleSquare").on("touchend",w)}this.solve=function(){for(var u,s,f,r=i.solve(v,c).found,n=0,h=r.length;n<h;n++){var e=r[n].word,l=r[n].orientation,a=r[n].x,y=r[n].y,p=i.orientations[l],o=t('input.word[value="'+e+'"]');if(!o.hasClass("wordFound")){for(u=0,s=e.length;u<s;u++)f=p(a,y,u),t('[x="'+f.x+'"][y="'+f.y+'"]').addClass("solved");o.addClass("wordFound")}}}};r.emptySquaresCount=function(){var n=t(".puzzleSquare").toArray();return n.length-n.filter(function(n){n.textContent.trim()}).length};r.append=function(n,i){t(n).append('<li class="word-to-find '+i+'">'+(i||"")+"<\/li>")};window.WordFindGame=r}(document,jQuery,wordfind);