var audioWin=new Audio("https://www.dropbox.com/s/b08q4h3i9m6k1f7/win.mp3?dl=1"),audioPowerOn=new Audio("https://www.dropbox.com/s/i0g9zunlyzhljwb/poweron.mp3?dl=1"),audioLose=new Audio("https://www.dropbox.com/s/ud4fafa7uifk7ah/loseSimon.mp3?dl=1"),audio,simon;audioLose.volume=.5;audio=[];audio[0]=new Audio("https://s3.amazonaws.com/freecodecamp/simonSound1.mp3");audio[1]=new Audio("https://s3.amazonaws.com/freecodecamp/simonSound2.mp3");audio[2]=new Audio("https://s3.amazonaws.com/freecodecamp/simonSound3.mp3");audio[3]=new Audio("https://s3.amazonaws.com/freecodecamp/simonSound4.mp3");simon={sequenceLength:0,sequence:[],seqItr:0,strict:!1,simonOn:!1,buttons:[".t-l",".t-r",".b-l",".b-r"],flashCount:0,flashScoreCount:0,tooLong:null,playerTurn:!1,timeoutEvents:[],clicked:0,buttonsOff:function(){for(var n=0;n<4;n++)$(simon.buttons[n]).removeClass("on")},playerClick:function(n){audio[n].pause();audio[n].currentTime=0;audio[n].play();$(simon.buttons[n]).addClass("on");window.setTimeout(function(n){$(simon.buttons[n]).removeClass("on")},500,n);this.sequence[this.seqItr]==n?this.seqItr==this.sequenceLength-1?(this.playerTurn=!1,this.play()):(this.seqItr++,simon.tooLong=window.setTimeout(function(){simon.gameOver(0)},5e3)):this.gameOver(0)},flashCurrent:function(){$(simon.buttons[simon.sequence[simon.seqItr]]).addClass("on");audio[simon.sequence[simon.seqItr]].play();simon.timeoutEvents.push(window.setTimeout(function(){$(simon.buttons[simon.sequence[simon.seqItr]]).removeClass("on");simon.seqItr++;simon.seqItr<simon.sequenceLength?simon.timeoutEvents.push(window.setTimeout(function(){simon.flashCurrent()},500)):(simon.playerTurn=!0,simon.seqItr=0,simon.tooLong=window.setTimeout(function(){simon.gameOver(0)},5e3))},750))},play:function(){if(this.sequenceLength==10)audioWin.play(),this.gameOver(1);else{this.sequenceLength++;this.updateCount();this.flashScoreCount=3;this.flashScore();var n=Math.floor(Math.random()*4);n==4&&(n=3);this.sequence.push(n);this.seqItr=0;simon.timeoutEvents.push(window.setTimeout(function(){simon.flashCurrent()},2500))}},turnOff:function(){this.reset();this.strict=!1;$(".m-strict .but .mini-but").removeClass("mini-on");$(".m-count .count").removeClass("on")},updateCount:function(){if(this.sequenceLength==0)$(".count").text("- -");else{var n=Math.floor(this.sequenceLength/10),t=this.sequenceLength%10;$(".count").text(n+" "+t)}},flashScore:function(){$(".count").removeClass("on");simon.timeoutEvents.push(window.setTimeout(function(){$(".count").addClass("on");simon.flashScoreCount>0&&(simon.flashScoreCount--,simon.timeoutEvents.push(window.setTimeout(function(){simon.flashScore()},150)))},150))},reset:function(){this.killTimeouts();this.buttonsOff();this.sequenceLength=0;this.seqItr=0;this.sequence=[];this.flashCount=0;this.flashScoreCount=0;this.playerTurn=!1;this.updateCount()},killTimeouts:function(){window.clearTimeout(simon.tooLong);tooLong=null;for(var n=0;n<simon.timeoutEvents.length;n++)window.clearTimeout(simon.timeoutEvents[n]);simon.timeoutEvents=[]},gameOver:function(n){n==0?(simon.seqItr=0,audioLose.play(),$(".count").text("!!!"),simon.flashScoreCount=3,simon.flashScore(),simon.strict?simon.timeoutEvents.push(window.setTimeout(function(){simon.reset();simon.play()},2e3)):simon.timeoutEvents.push(window.setTimeout(function(){simon.updateCount();simon.flashScoreCount=3;simon.flashScore();simon.timeoutEvents.push(window.setTimeout(function(){simon.flashCurrent()},2500))},2e3))):($(".count").text("WIN"),simon.flashScoreCount=10,simon.flashScore(),simon.flashCount=10,simon.flash(0),simon.isWon=!0)},flash:function(n){$(simon.buttons[n]).addClass("on");simon.timeoutEvents.push(window.setTimeout(function(){$(simon.buttons[n]).removeClass("on");n<3?simon.flash(n+1):simon.flashCount>0?(simon.flashCount--,simon.flash(0)):simon.isWon&&(simon.isWon=!1,setTimeout(function(){window.parent.postMessage("quest-ok","*")},2e3))},50))}};jQuery(document).ready(function(n){n(".on-off").click(function(){var t=n(this).find(".but");n(t).hasClass("active")?(n(t).removeClass("active"),simon.simonOn=!1,simon.turnOff()):(n(t).addClass("active"),simon.simonOn=!0,n(".m-count .count").addClass("on"),audioPowerOn.play(),simon.flash(0))});n(".m-strict .but").click(function(){var t,i;n(this).css("height","24px");n(this).css("width","24px");n(this).css("margin-bottom","11px");simon.simonOn&&(t=n(this).find(".mini-but"),n(t).hasClass("mini-on")?(n(t).removeClass("mini-on"),simon.strict=!1):(n(t).addClass("mini-on"),simon.strict=!0));i=this;simon.timeoutEvents.push(window.setTimeout(function(){n(".m-strict .but").css("height","25px");n(".m-strict .but").css("width","25px");n(".m-strict .but").css("margin-bottom","10px")},100))});n(".m-start .but").click(function(){n(this).css("height","24px");n(this).css("width","24px");n(this).css("margin-bottom","11px");simon.timeoutEvents.push(window.setTimeout(function(){n(".m-start .but").css("height","25px");n(".m-start .but").css("width","25px");n(".m-start .but").css("margin-bottom","10px")},100));simon.simonOn&&window.setTimeout(function(){simon.reset();simon.play()},250)});n(".t-l").click(function(){simon.playerTurn&&(window.clearTimeout(simon.tooLong),simon.playerClick(simon.clicked=0))});n(".t-r").click(function(){simon.playerTurn&&(window.clearTimeout(simon.tooLong),simon.playerClick(simon.clicked=1))});n(".b-l").click(function(){simon.playerTurn&&(window.clearTimeout(simon.tooLong),simon.playerClick(simon.clicked=2))});n(".b-r").click(function(){simon.playerTurn&&(window.clearTimeout(simon.tooLong),simon.playerClick(simon.clicked=3))})});