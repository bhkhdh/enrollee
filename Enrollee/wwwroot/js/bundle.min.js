var getComments=function(){var n=$(this).attr("data-page");$.ajax({url:"/Comments/GetComments",type:"GET",data:{page:n},success:function(n){$("#CommentListSegment").html(n)},error:function(){alert("Something happened!")}})};$(document).ready(function(){$("#SubmitComment").click(function(){var n=$("#CommentText").val();$.ajax({url:"/Comments/CreateFromPartial",data:{data:n},type:"POST",success:function(){$("#CommentText").val("");getComments()},error:function(){alert("Something happened")}})})});$("#CommentListSegment").on("click",".SwitchPageBtn",getComments);(function(){var n=window.$game={_mode:null,busy:!1},o,y,h,c,u,f,s,r,t,e,l,a,v,i;n.save=function(){return{mode:this._mode,map:this.map.save(),dialog:this.dialog.save()}};n.load=function(n){this.mode(n.mode);this.map.load(n.map);this.dialog.load(n.dialog)};n.mode=function(n,t){if(!this.busy){switch(n){case"dialog":this.map.show(!1);this.dialog.goto(null,t);break;case"map":this.map.show(!0);this.dialog.show(!1);break;default:console.error("Invalid mode '"+n+"'")}this._mode=n}};u=n.map={_areas:{}};u.save=function(){return{}};u.load=function(){};u.addArea=function(n,t,i){var r=this._areas[n]={name:n,pos:t.slice(),menu:i.slice()}};u.show=function(t){var u,r,i;if(!n.busy){if(t&&!this._init){this._init=!0;for(u in this._areas)this._areas.hasOwnProperty(u)&&(r=this._areas[u],i=r.elem=$("<div><\/div>"),i.appendTo(o),i.addClass("map-area"),i.css("left",r.pos[0]+"%"),i.css("top",r.pos[1]+"%"),i.css("width",r.pos[2]+"%"),i.css("height",r.pos[3]+"%"),i.click(this._showChapterMenu.bind(this,r)))}o.css("display",t?"":"none")}};u._showChapterMenu=function(n){var e=$("#map-chapter-menu-item").html(),i,t,r,u,f;for(c.html(null),i=0;i<n.menu.length;i++)t=n.menu[i],r=$(e),r.appendTo(c),u=$(".cc-img",r),f=$(".cc-text",r),f.html(t.name),t.icon&&u.attr("src",t.icon),u.click(this._selectChapter.bind(this,t));h.modal("show")};u._selectChapter=function(t){h.modal("hide");t.dialog&&n.mode("dialog",t.dialog)};i=n.dialog={_stages:{},_actions:{},_index:0,_stage:null};i.save=function(){return{index:this._index,stage:this._stage.name,image:t.attr("src"),scene:$U.getBgImage(e),text:s.html(),name:r.html()}};i.load=function(n){this._index=n.index;this._stage=this._stages[n.stage];n.image?(t.attr("src",n.image),t.removeClass("dg-hidden")):t.addClass("dg-hidden");$U.setBgImage(e,n.scene);s.html(n.text);n.name?(r.html(n.name),r.css("display","")):r.css("display","none")};i.setStage=function(n,t){for(var r={},i=0;i<t.length;i++)t[i].id&&(r[t[i].id]=i);this._stages[n]={name:n,data:t.slice(),labels:r}};i.setAction=function(n,t){this._actions[n]=t};i.advance=function(){var i,h,o,u,c;if(this._stage&&!n.busy){n:while(i=this._stage.data[this._index]){this._index++;switch(i.do){case"say":s.html(i.text);i.name?(r.css("display",""),r.html(i.name)):r.css("display","none");break n;case"image":if(h=t.attr("src"),o=i.url||f,i.now&&h!=f&&o!=f){t.attr("src",o);break}else{u=$U.always({self:this,url:o});h!=f&&(u=u.then(function(n){return t.addClass("dg-hidden"),$U.delay(500,n)}));o!=f&&(u=u.then(function(n){return t.attr("src",n.url),t.removeClass("dg-hidden"),$U.delay(500,n)}));u.then(function(t){n.busy=!1;t.self.advance()});n.busy=!0;break n}case"scene":u=$U.always({url:i.url,self:this});u.then(function(n){return l.addClass("dg-faded"),$U.delay(500,n)}).then(function(n){return l.removeClass("dg-faded"),$U.setBgImage(e,n.url),$U.delay(500,n)}).then(function(t){n.busy=!1;t.self.advance()});n.busy=!0;break n;case"goto":this._goto(i.label,i.stage);break;case"action":(c=this._actions[i.name])?c.apply(n,i.args):i.name&&console.error("Invalid action '"+i.name+"'")}}v.css("display",i?"":"none")}};i._goto=function(n,t){var i,r;if(t){if(i=this._stages[t],!i){console.error("Invalid stage '"+t+"'");return}this._stage=i}if(n){if(r=this._stage.labels[n],!r){console.error("Invalid label '"+n+"'");return}this._index=r}else this._index=0};i.goto=function(t,i){n.busy||(this._goto(t,i),this.advance())};i.show=function(t){this._stage&&!n.busy&&(a.css("display",t?"":"none"),e.css("display",t?"":"none"))};i.setAction("show",function(){this.dialog.show(!0)});i.setAction("hide",function(){this.dialog.show(!1)});i.setAction("ChapterDone",function(){this.mode("map")});$(document).ready(function(){s=$(".dg-text span.text");r=$(".dg-text span.name");t=$(".dg-image img");e=$(".dialog-scene");l=$(".dialog-fade");a=$(".dialog-box");v=$(".dialog-box a.next-btn");f=t.attr("src");t.addClass("dg-hidden");o=$(".map-body");y=$(".map-body img.map-bg");h=$("#map-chapter-menu");c=$("#map-chapter-menu .ch-list");v.click(function(){n.dialog.advance()});$(".game .play-btn").click(function(){$(this).css("display","none");n.mode("map")});e.css("display","none");a.css("display","none");o.css("display","none")})}).call(this),function(){var n=window.$U={};n.getBgImage=function(n){var i=$(n).css("background-image"),t=i.match(/url\("(.+)"\)/i);return t&&t[1]?t[1]:null};n.setBgImage=function(n,t){t?(t='url("'+t.replace('"',"%22")+'")',$(n).css("background-image",t)):$(n).css("background-image","none")};n.delay=function(n,t){return $.Deferred(function(i){setTimeout(i.resolve.bind(null,t),n)})};n.always=function(n){return $.Deferred(function(t){t.resolve.call(null,n)})}}.call(this);$(document).ready(function(){$("div.has-bg img").each(function(){var n=$(this);$U.setBgImage(n.parent(),n.attr("src"));n.remove()});var n=$(".fullscreen-btn > a");n.attr("href","javascript:void(0)");n.click(function(){if(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen();else{var t=$(this).attr("data-target"),n=document.getElementById(t);n.requestFullscreen?n.requestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen():n.msRequestFullscreen&&n.msRequestFullscreen()}})});